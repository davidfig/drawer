<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>yy-drawer API Documentation</title>
    
    <meta name="description" content="Documentation for yy-drawer library" />
    
        <meta name="keywords" content="docs, documentation, html5, javascript, jsdoc, drawer, UI" />
        <meta name="keyword" content="docs, documentation, html5, javascript, jsdoc, drawer, UI" />
    
    
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link href="https://fonts.googleapis.com/css?family=Libre+Franklin:400,700" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/main.css">

    
    <script>
    var config = {"monospaceLinks":false,"cleverLinks":false,"default":{"outputSourceFiles":true},"applicationName":"yy-drawer","footer":"by YOPEY YOPEY LLC (yopeyopey.com)","copyright":"Copyright Â© 2018 YOPEY YOPEY LLC.","meta":{"title":"yy-drawer API Documentation","description":"Documentation for yy-drawer library","keyword":"docs, documentation, html5, javascript, jsdoc, drawer, UI"}};
    </script>
    

    
</head>
<body>
<div id="wrap" class="clearfix">
    
<div class="navigation">
    <h3 class="applicationName"><a href="index.html">yy-drawer</a></h3>
    <button id="menuToggle" class="btn btn-link btn-lg menu-toggle">
        <span class="glyphicon glyphicon-menu-hamburger"></span>
    </button>
    <div class="search">
        <input id="search" type="text" class="form-control input-md" placeholder="Search...">
    </div>
    <ul class="list">
    
        
        <li class="item" data-name="global">
            <span class="title namespace ">
                
                <span class="namespaceTag">
                    <span class="glyphicon glyphicon-globe"></span>
                </span>
                
                <a href="global.html">Global</a>
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            <span class="subtitle">Typedefs</span>
            
                <li class="parent" data-name="PointLike"><a href="global.html#PointLike">PointLike</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li class="parent  " data-name="distance"><a href="global.html#distance">distance</a></li>
            
                <li class="parent  " data-name="distanceToClosestCorner"><a href="global.html#distanceToClosestCorner">distanceToClosestCorner</a></li>
            
                <li class="parent  " data-name="inside"><a href="global.html#inside">inside</a></li>
            
                <li class="parent  " data-name="options"><a href="global.html#options">options</a></li>
            
                <li class="parent  " data-name="percentage"><a href="global.html#percentage">percentage</a></li>
            
                <li class="parent  " data-name="style"><a href="global.html#style">style</a></li>
            
                <li class="parent  " data-name="toGlobal"><a href="global.html#toGlobal">toGlobal</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        
        <li class="item" data-name="Drawer">
            <span class="title  ">
                
                <a href="Drawer.html">Drawer</a>
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li class="parent " data-name="Drawer.defaults"><a href="Drawer.html#.defaults">defaults</a></li>
            
                <li class="parent " data-name="Drawer#auto"><a href="Drawer.html#auto">auto</a></li>
            
                <li class="parent " data-name="Drawer#bar"><a href="Drawer.html#bar">bar</a></li>
            
                <li class="parent " data-name="Drawer#bottom"><a href="Drawer.html#bottom">bottom</a></li>
            
                <li class="parent " data-name="Drawer#content"><a href="Drawer.html#content">content</a></li>
            
                <li class="parent " data-name="Drawer#div"><a href="Drawer.html#div">div</a></li>
            
                <li class="parent " data-name="Drawer#duration"><a href="Drawer.html#duration">duration</a></li>
            
                <li class="parent " data-name="Drawer#left"><a href="Drawer.html#left">left</a></li>
            
                <li class="parent " data-name="Drawer#location"><a href="Drawer.html#location">location</a></li>
            
                <li class="parent " data-name="Drawer#minVelocity"><a href="Drawer.html#minVelocity">minVelocity</a></li>
            
                <li class="parent " data-name="Drawer#right"><a href="Drawer.html#right">right</a></li>
            
                <li class="parent " data-name="Drawer#threshold"><a href="Drawer.html#threshold">threshold</a></li>
            
                <li class="parent " data-name="Drawer#timeRecent"><a href="Drawer.html#timeRecent">timeRecent</a></li>
            
                <li class="parent " data-name="Drawer#top"><a href="Drawer.html#top">top</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li class="parent  " data-name="Drawer#close"><a href="Drawer.html#close">close</a></li>
            
                <li class="parent  " data-name="Drawer#open"><a href="Drawer.html#open">open</a></li>
            
                <li class="parent  " data-name="Drawer#toggle"><a href="Drawer.html#toggle">toggle</a></li>
            
                <li class="parent  " data-name="Drawer#updateContents"><a href="Drawer.html#updateContents">updateContents</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            <span class="subtitle">Events</span>
            
                <li class="parent" data-name="Drawer~event:closed"><a href="Drawer.html#~event:closed">closed</a></li>
            
                <li class="parent" data-name="Drawer~event:closing"><a href="Drawer.html#~event:closing">closing</a></li>
            
                <li class="parent" data-name="Drawer~event:location"><a href="Drawer.html#~event:location">location</a></li>
            
                <li class="parent" data-name="Drawer~event:opened"><a href="Drawer.html#~event:opened">opened</a></li>
            
                <li class="parent" data-name="Drawer~event:opening"><a href="Drawer.html#~event:opening">opening</a></li>
            
            </ul>
        </li>
    
    </ul>
</div>
    <div class="main">
        
        <h1 class="page-title" data-filename="Drawer">Source: drawer.js</h1>
        
        


    
    <section>
        <header>
            <div class="header content-size">
                <h2>drawer.js</h2>
            </div>
        </header>
        <article>
            <pre id="source-code" class="prettyprint source "><code>const Penner = require('penner')
const moment = require('moment')
const Events = require('eventemitter3')

const utils = require('./utils')
let defaults = require('./defaults')

class Drawer extends Events
{
    /**
     * @param {object} [options]
     * @param {HTMLElement} [options.parent=document.body] where to attach the drawer
     * @param {boolean} [options.auto=true] automatically open and close the drawer based on acceleration or click
     * @param {string} [options.side=left] (left, right, top, or bottom)
     * @param {number} [options.size] size (in pixels) of opened drawer
     * @param {number} [options.barSize=20] size (in pixels) of drag bar
     * @param {boolean} [options.full=true] whether the drawer should take up the full width or height
     * @param {boolean} [options.open] start with drawer open
     * @param {boolean} [options.noInteraction] open drawer only programmatically
     * @param {object} [options.styles] styles for div
     * @param {string} [options.className] class name for div
     * @param {string} [options.barBackground=rgba(0,0,0,0.25)] background setting for drag bar
     * @param {string} [options.ease=easeInOutSine] ease for animated opening
     * @param {number} [options.duration=500] animate time for opening drawer on click
     * @param {number} [options.threshold=10] number of pixels before move starts
     * @param {number} [options.timeRecent=100] maximum time in milliseconds to use when calculating acceleration
     * @param {number} [options.minVelocty=0.5] minimum velocity (pixels/millisecond) for opening and closing after a drag
     * @param {string} [options.content] HTML content for the drawer
     * @param {object} [options.contentStyles] styles for content of drawer
     * @fires opening
     * @fires closing
     * @fires opened
     * @fires closed
     * @fires location
     */
    constructor(options)
    {
        super()
        this.options = utils.options(options, Drawer._defaults)
        this.options.parent = this.options.parent || document.body
        this._size = this.options.size
        this._barSize = this.options.barSize
        this.ease = this.options.ease ? (typeof this.options.ease === 'function' ? this.options.ease : Penner[this.options.ease]) : Penner['easeInOutSine']
        this.all = ['left', 'right', 'top', 'bottom']

        /**
         * minimum velocity (pixels/millisecond) for opening and closing after a drag
         * @type (number)
         */
        this.minVelocity = this.options.minVelocity

        /**
         * maximum time in milliseconds to use when calculating acceleration
         * @type {number}
         */
        this.timeRecent = this.options.timeRecent

        /**
         * automatically open and close the drawer based on acceleration or click
         * @type {boolean}
         */
        this.auto = this.options.auto

        /**
         * number of pixels before move starts after a mousedown or touchstart
         * @type {number}
         */
        this.threshold = this.options.threshold

        /**
         * animate time for opening drawer on click
         * @type {number}
         **/
        this.duration = this.options.duration

        /**
         * Main drawer element
         * @type {HTMLElement}
         */
        this.div = utils.html({
            parent: this.options.parent,
            defaultStyles: {
                'position': 'fixed',
                'background': 'white'
            },
            styles: this.options.styles
        })

        /**
         * use this to add content to the div
         * @type {HTMLElement}
         */
        this.content = utils.html({ parent: this.div, styles: this.options.contentStyles, html: this.options.content })

        if (this.options.className)
        {
            this.div.className = this.options.className
        }

        /**
         * Bar drawer element
         * @type {HTMLElement}
         */
        this.bar = utils.html({
            parent: this.options.parent,
            styles: {
                'position': 'fixed',
                'background': this.options.barBackground || 'rgba(0,0,0,0.15)',
                'cursor': ['drag', '-webkit-grab', 'pointer']
            }
        })
        if (!this.options.noInteraction)
        {
            this._addListeners()
        }
        else
        {
            this.bar.style.display = 'none'
        }
        this._side = this.options.side
        this.vertical = this.side === 'left' || this.side === 'right'
        this._setSide(true)
        this.location = 0
        if (this.options.open)
        {
            this.open(true)
        }
        else
        {
            this.close(true)
        }
    }

    /**
     * call this to update the contents or after the contents of the drawer are updated (handles sizing)
     * @param {string} [content]
     */
    updateContents(content)
    {
        if (content)
        {
            this.content.innerHTML = content
        }
        this._setSide(true)
    }

    get side()
    {
        return this._side
    }
    set side(value)
    {
        if (this._side !== value)
        {
            this._side = value
            this.vertical = value === 'left' || value === 'right'
            this._setSide()
            if (this.opened)
            {
                this.open(true)
            }
        }
    }

    get size()
    {
        if (this._size)
        {
            return this._size
        }
        else
        {
            if (this.side === 'left' || this.side === 'right')
            {
                return this.div.offsetWidth
            }
            else
            {
                return this.div.offsetHeight
            }
        }
    }
    set size(value)
    {
        this._size = value
        this._setSide(true)
        if (this.opened)
        {
            this.open(false)
        }
    }

    get barSize()
    {
        return this._barSize
    }
    set barSize(value)
    {
        this._barSize = value
        this._setSide(true)
        if (this.opened)
        {
            this.open(false)
        }
    }

    /**
     * change top value of drawer
     * @type {number}
     */
    get top()
    {
        return this.div.style.top
    }
    set top(value)
    {
        this.div.style.top = this.bar.style.top = value
    }

    /**
     * change left value of drawer
     * @type {number}
     */
    get left()
    {
        return this.div.style.left
    }
    set left(value)
    {
        this.div.style.left = this.bar.style.left = value
    }

    /**
     * change bottom value of drawer
     * @type {number}
     */
    get bottom()
    {
        return this.div.style.bottom
    }
    set bottom(value)
    {
        this.div.style.bottom = this.bar.style.bottom = value
    }

    /**
     * change right value of drawer
     * @type {number}
     */
    get right()
    {
        return this.div.style.right
    }
    set right(value)
    {
        this.div.style.right = this.bar.style.right = value
    }

    _setSide(noReset)
    {
        if (!noReset)
        {
            for (let side of this.all)
            {
                if (side !== this.side)
                {
                    this.div.style[side] = 'unset'
                    this.bar.style[side] = 'unset'
                }
            }
        }
        if (this.vertical)
        {
            this.div.style.width = this._size ? this._size + 'px' : 'auto'
            this.bar.style.width = this.barSize + 'px'
            if (this.opened)
            {
                this.div.style[this._side] = 0
                this.bar.style[this._side] = this.div.offsetWidth + 'px'
            }
            else
            {
                this.div.style[this._side] = -this.size + 'px'
                this.bar.style[this._side] = 0
            }
            if (this.options.full)
            {
                this.div.style.top = this.bar.style.top = 0
                this.div.style.height = this.bar.style.height = '100vh'
            }
            else
            {
                this.bar.style.height = this.div.offsetHeight + 'px'
                this.bar.style.top = this.div.offsetTop + 'px'
            }
        }
        else
        {
            this.div.style.height = this._size ? this._size + 'px' : 'auto'
            this.bar.style.height = this.barSize + 'px'
            if (this.opened)
            {
                this.div.style[this._side] = 0
                this.bar.style[this._side] = this.div.offsetHeight + 'px'
            }
            else
            {
                this.div.style[this._side] = -this.size + 'px'
                this.bar.style[this._side] = 0
            }
            if (this.options.full)
            {
                this.div.style.left = this.bar.style.left = 0
                this.div.style.width = this.bar.style.width = '100vw'
            }
            else
            {
                this.bar.style.width = this.div.offsetWidth + 'px'
                this.bar.style.left = this.div.offsetLeft + 'px'
            }
        }
        if (this.opened)
        {
            this.open(true)
        }
        else
        {
            this.close(true)
        }
    }

    _addListeners()
    {
        this.bar.addEventListener('mousedown', (e) => this._down(e))
        this.bar.addEventListener('touchstart', (e) => this._down(e))
        this.bar.addEventListener('mousemove', (e) => this._move(e), { passive: false })
        this.bar.addEventListener('touchmove', (e) => this._move(e), { passive: false })
        document.body.addEventListener('mousemove', (e) => this._move(e), { passive: false })
        document.body.addEventListener('touchmove', (e) => this._move(e), { passive: false })
        this.bar.addEventListener('mouseup', (e) => this._up(e))
        this.bar.addEventListener('touchend', (e) => this._up(e))
        document.body.addEventListener('mouseup', (e) => this._up(e))
        document.body.addEventListener('mouseleave', (e) => this._up(e))
        document.body.addEventListener('touchend', (e) => this._up(e))
    }

    _down(e)
    {
        this.down = { x: e.pageX, y: e.pageY }
        this.changes = []
        this.moving = false
        if (this.bar.style.cursor === 'grab' || this.bar.style.cursor === '-webkit-grab')
        {
            utils.styles(this.bar, { 'cursor': ['grabbing', '-webkit-grabbing' ]})
        }
        e.preventDefault()
    }

    _checkThreshold(e)
    {
        if (!this.moving)
        {
            if (this.side === 'left' || this.side === 'right')
            {
                if (Math.abs(e.pageX - this.down.x) >= this.threshold)
                {
                    this.moving = true
                    return true
                }
                else
                {
                    return false
                }
            }
            else
            {
                if (Math.abs(e.pageY - this.down.y) >= this.threshold)
                {
                    this.moving = true
                    return true
                }
                else
                {
                    return false
                }
            }
        }
        else
        {
            return true
        }
    }

    _move(e)
    {
        if (this.down &amp;&amp; this._checkThreshold(e))
        {
            let value
            if (this.vertical)
            {
                if (this.side === 'left')
                {
                    value = e.pageX - this.barSize / 2
                }
                else
                {
                    value = window.innerWidth - e.pageX + this.barSize / 2
                }
            }
            else
            {
                if (this.side === 'top')
                {
                    value = e.pageY - this.barSize / 2
                }
                else
                {
                    value = window.innerHeight - e.pageY + this.barSize / 2
                }
            }
            value -= this.size
            value = value > 0 ? 0 : value
            value = value &lt; -this.size ? -this.size : value
            this.location = value
            this.changes.push({ value, time: moment() })
            e.preventDefault()
        }
    }

    /**
     * location of the drawer relative to the edge
     * @type {number}
     */
    get location()
    {
        return this._location
    }
    set location(value)
    {
        if (this._location !== value)
        {
            this.div.style[this.side] = value + 'px'
            this.bar.style[this.side] = value + this.size + 'px'
            this._location = value
            if (value === 0)
            {
                this.opened = true
                this.emit('opened', this)
            }
            else if (value === -this.size)
            {
                this.opened = false
                this.emit('closed', this)
            }
            this.emit('location', value + this.size, this)
        }
    }

    _getVelocity()
    {
        const now = moment()
        let current = this.changes[this.changes.length - 1]
        for (let i = this.changes.length - 2; i >= 0; i--)
        {
            if (now.diff(this.changes[i].time) > this.timeRecent)
            {
                i = i &lt; this.changes.length - 1 ? i + 1 : i
                break
            }
            else
            {
                current = this.changes[i]
            }
        }
        const last = this.changes[this.changes.length - 1]
        const deltaDistance = current.value - last.value
        const deltaTime = current.time.diff(last.time)
        return deltaDistance / deltaTime
    }

    _up()
    {
        if (this.down)
        {
            if (!this.moving)
            {
                this.toggle()
            }
            else if (this.auto)
            {
                if (this.changes.length > 2)
                {
                    let velocity = this._getVelocity()
                    if (velocity === 0)
                    {
                        this._forceToggle()
                    }
                    else
                    {
                        if (Math.abs(velocity) &lt; this.minVelocity)
                        {
                            velocity = this.minVelocity * (velocity &lt; 0 ? -1 : 1)
                        }
                        if (velocity > 0)
                        {
                            this._openAnimate(velocity)
                        }
                        else
                        {
                            this._closeAnimate(velocity)
                        }
                    }
                }
                else
                {
                    this._forceToggle()
                }
            }
            if (this.bar.style.cursor === 'grabbing' || this.bar.style.cursor === '-webkit-grabbing')
            {
                utils.styles(this.bar, { 'cursor': ['grab', '-webkit-grab'] })
            }
            this.down = false
        }
    }

    _forceToggle()
    {
        if (this.div.offsetWidth > this.size / 2)
        {
            this.open()
        }
        else
        {
            this.close()
        }
    }

    /**
     * toggle the drawer (close if open, and open if closed)
     * @param {boolean} [noAnimate] do not animate
     */
    toggle(noAnimate)
    {
        if (this.opened)
        {
            this.close(noAnimate)
        }
        else
        {
            this.open(noAnimate)
        }
    }

    /**
     * open the drawer
     * @param {boolean} [noAnimate]
     */
    open(noAnimate)
    {
        if (this.down || !this.opened)
        {
            this.easing = null
            if (noAnimate)
            {
                this.div.style[this.side] = 0
                this.bar.style[this.side] = this.size + 'px'
                this.emit('opened', this)
            }
            else
            {
                this._openAnimate()
                this.emit('opening', this)
            }
            this.opened = true
        }
    }

    _openAnimate(velocity)
    {
        const duration = velocity ? Math.abs((0 - this.size) / velocity) : this.duration
        this.easing = { start: this.location, end: 0, time: moment(), ease: velocity ? Penner.linear : this.ease, duration, type: 'open' }
        requestAnimationFrame(() => this.update())
    }

    /**
     * close the drawer
     * @param {boolean} [noAnimate]
     */
    close(noAnimate)
    {
        if (this.down || this.opened)
        {
            this.easing = null
            if (noAnimate)
            {
                this.location = -this.size
                this.emit('closed', this)
            }
            else
            {
                this._closeAnimate()
                this.emit('closing', this)
            }
            this.opened = false
        }
    }

    _closeAnimate(velocity)
    {
        const start = this.location
        const duration = velocity ? Math.abs((start - this.size) / velocity) : this.duration
        this.easing = { start, end: -this.size, time: moment(), ease: velocity ? Penner.linear : this.ease, duration, type: 'close' }
        requestAnimationFrame(() => this.update())
    }

    update()
    {
        if (this.easing)
        {
            let duration = moment().diff(this.easing.time)
            duration = duration > this.easing.duration ? this.easing.duration : duration
            this.location = this.ease(duration, this.easing.start, this.easing.end - this.easing.start, this.easing.duration)
            if (duration === this.easing.duration)
            {
                if (this.easing.type === 'open')
                {
                    this.emit('opened', this)
                }
                else
                {
                    this.emit('closed', this)
                }
                this.easing = null
            }
            else
            {
                requestAnimationFrame(() => this.update())
            }
        }
    }

    /**
     * defaults for Drawer
     * @type {object}
     */
    static get defaults()
    {
        return Drawer._defaults
    }
    static set defaults(value)
    {
        Drawer._defaults = value
    }
}

Drawer.defaults = defaults

module.exports = Drawer

/**
  * trigger when the drawer is opening from UI click or calling drawer.open()
  * @event Drawer~opening
  * @type {object}
  * @property {Drawer} drawer
  */

/**
  * trigger when drawing is closing from UI click or calling drawer.close()
  * @event Drawer~closing
  * @type {object}
  * @property {Drawer} drawer
  */

/**
  * trigger when drawer is fully opened because of UI interaction or drawer.open() finishing
  * @event Drawer~opened
  * @type {object}
  * @property {Drawer} drawer
  */

/**
  * trigger when drawer is fully closed because of UI interaction or drawer.close() finishing
  * @event Drawer~closed
  * @type {object}
  * @property {Drawer} drawer
  */

/**
  * trigger when drawer's location changes because of UI interaction or drawer.close/open
  * @event Drawer~location
  * @type {object}
  * @property {number} location of drawer
  * @property {Drawer} drawer
  */</code></pre>
        </article>
    </section>






        

        <footer class="content-size">
            <div class="footer">
                Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sat Oct 13 2018 09:47:02 GMT+0800 (DST)
            </div>
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/main.js"></script>
</body>
</html>
